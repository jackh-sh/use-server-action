# withZodValidation

Before using this middleware, you'll need to install zod:

```bash npm2yarn
npm install zod
```

This middleware validates input against a Zod-compatible schema.

## Usage with createAction (Recommended)

```ts
import { z } from "zod";
import { createAction, withZodValidation } from "use-server-action/server";

const CreateUserSchema = z.object({
    name: z.string().min(1, "Name is required"),
    email: z.string().email("Invalid email"),
});

export const createUser = createAction<z.infer<typeof CreateUserSchema>>()
    .use(withZodValidation(CreateUserSchema))
    .handle(async (ctx, input) => {
        // input is validated and typed
        const user = await db.user.create({ data: input });
        return { ok: true, data: user };
    });
```

## Legacy Usage (Deprecated)

> **Deprecated:** Use `createAction().use(withZodValidation(schema)).handle(fn)` instead.

```ts
import { z } from "zod";
import { withZodValidation, applyMiddleware, serverAction } from "use-server-action/server";

const CreateUserSchema = z.object({
    name: z.string().min(1, "Name is required"),
    email: z.string().email("Invalid email"),
});

const createUser = serverAction(async (input: z.infer<typeof CreateUserSchema>) => {
    return await db.user.create({ data: input });
});

export const validatedCreateUser = applyMiddleware(createUser, [
    withZodValidation(CreateUserSchema),
]);
```

## Options

```ts
withZodValidation(schema, {
    // Custom error code (default: "VALIDATION_ERROR")
    code: "INVALID_INPUT",

    // Custom error message formatter
    formatError: (error) => {
        return error.errors?.map(e => e.message).join(", ") ?? "Invalid input";
    },
});
```
